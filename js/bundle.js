webpackJsonp([0],{124:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(t,e,n,r,i,o){var a=i.add.text(t,e,n,{color:"#000"}),s=i.add.image(t-15,e-10,"panel");return s.setOrigin(0,0),r.add(s),r.add(a),s.setInteractive(),s.displayWidth=a.width+30,s.displayHeight=a.height+20,s.on("pointerdown",function(){o()}),s};e.default=r},1463:function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=r(n(31)),o=n(39),a=r(n(556)),s=n(46),u=r(n(124)),c=r(n(557)),d=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),l=function(t){function e(){var e=t.call(this,"TitleScene")||this;return e.preload=s.preload,e}return d(e,t),e.prototype.create=function(){var t=this;(0,c.default)(this);var e=this.add.container(0,0);(0,u.default)(20,50,"List Units",e,this,function(){t.scene.transition({target:"ListUnitsScene",duration:0,moveBelow:!0})}),(0,u.default)(20,100,"Edit Squad 0",e,this,function(){t.scene.transition({target:"EditSquadScene",duration:0,moveBelow:!0,data:{squad:(0,o.getSquads)()[0]}})}),(0,u.default)(20,150,"List Squads",e,this,function(){t.scene.start("ListSquadsScene")}),(0,u.default)(20,200,"Map",e,this,function(){t.scene.start("MapScene")}),(0,u.default)(20,250,"Combat",e,this,function(){t.scene.start("CombatScene",{top:"0",bottom:"3"})}),(0,u.default)(20,600,"Erase Data",e,this,function(){(0,a.default)(),alert("Data erased!")}),(0,u.default)(220,600,"Go Fullscreen",e,this,function(){window.document.body.requestFullscreen()})},e}(i.default.Scene),f=l;e.default=f},1464:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.unitsWithoutSquadSelector=void 0;var r=function(t){return Object.entries(t).filter(function(t){t[0];return null===t[1].squad}).map(function(t){t[0];return t[1]})};e.unitsWithoutSquadSelector=r},1465:function(t,e){t.exports=[{name:"Iron Sword",type:"sword",description:"A short sword",atk:"3",m_atk:"0",def:"0",m_def:"0",str:"0",int:"0",agi:"0",dex:"0",vit:"0",wis:"0",res_fire:"0",res_wind:"0",res_earth:"0",res_water:"0",res_light:"0",res_shadow:"0",atk_fire:"0",atk_wind:"0",atk_earth:"0",atk_water:"0",atk_light:"0",atk_hadow:"0"},{name:"Iron Armor",type:"light_armor",description:"A simple metal armor",atk:"0",m_atk:"0",def:"3",m_def:"0",str:"0",int:"0",agi:"0",dex:"0",vit:"0",wis:"0",res_fire:"0",res_wind:"0",res_earth:"0",res_water:"0",res_light:"0",res_shadow:"0",atk_fire:"0",atk_wind:"0",atk_earth:"0",atk_water:"0",atk_light:"0",atk_hadow:"0"},{name:"Iron Shield",type:"shield",description:"A simple metal shield",atk:"0",m_atk:"0",def:"4",m_def:"0",str:"0",int:"0",agi:"0",dex:"0",vit:"0",wis:"0",res_fire:"0",res_wind:"0",res_earth:"0",res_water:"0",res_light:"0",res_shadow:"0",atk_fire:"0",atk_wind:"0",atk_earth:"0",atk_water:"0",atk_light:"0",atk_hadow:"0"},{name:"Amulet",type:"accessory",description:"An amulet used in encantations",atk:"0",m_atk:"2",def:"0",m_def:"2",str:"0",int:"2",agi:"0",dex:"0",vit:"0",wis:"0",res_fire:"0",res_wind:"0",res_earth:"0",res_water:"0",res_light:"0",res_shadow:"0",atk_fire:"0",atk_wind:"0",atk_earth:"0",atk_water:"0",atk_light:"0",atk_hadow:"0"},{name:"Steel Sword",type:"sword",description:"A high quality sword",atk:"5",m_atk:"0",def:"0",m_def:"0",str:"0",int:"0",agi:"0",dex:"0",vit:"0",wis:"0",res_fire:"0",res_wind:"0",res_earth:"0",res_water:"0",res_light:"0",res_shadow:"0",atk_fire:"0",atk_wind:"0",atk_earth:"0",atk_water:"0",atk_light:"0",atk_hadow:"0"},{name:"Steel Armor",type:"light_armor",description:"A very resistant armor",atk:"0",m_atk:"0",def:"5",m_def:"0",str:"0",int:"0",agi:"0",dex:"0",vit:"0",wis:"0",res_fire:"0",res_wind:"0",res_earth:"0",res_water:"0",res_light:"0",res_shadow:"0",atk_fire:"0",atk_wind:"0",atk_earth:"0",atk_water:"0",atk_light:"0",atk_hadow:"0"},{name:"Steel Shield",type:"shield",description:"You can trust in this shield",atk:"0",m_atk:"0",def:"6",m_def:"0",str:"0",int:"0",agi:"0",dex:"0",vit:"0",wis:"0",res_fire:"0",res_wind:"0",res_earth:"0",res_water:"0",res_light:"0",res_shadow:"0",atk_fire:"0",atk_wind:"0",atk_earth:"0",atk_water:"0",atk_light:"0",atk_hadow:"0"},{name:"Baldar Sword",type:"sword",description:"One of the best swords that you can find",atk:"7",m_atk:"0",def:"0",m_def:"0",str:"2",int:"0",agi:"0",dex:"0",vit:"0",wis:"0",res_fire:"0",res_wind:"0",res_earth:"0",res_water:"0",res_light:"0",res_shadow:"0",atk_fire:"0",atk_wind:"0",atk_earth:"0",atk_water:"0",atk_light:"0",atk_hadow:"0"},{name:"Baldar Armor",type:"light_armor",description:"This armor can keep you safe",atk:"0",m_atk:"0",def:"8",m_def:"0",str:"2",int:"0",agi:"0",dex:"0",vit:"0",wis:"0",res_fire:"0",res_wind:"0",res_earth:"0",res_water:"0",res_light:"0",res_shadow:"0",atk_fire:"0",atk_wind:"0",atk_earth:"0",atk_water:"0",atk_light:"0",atk_hadow:"0"},{name:"Baldar Shield",type:"shield",description:"An unbreakable shield",atk:"0",m_atk:"0",def:"9",m_def:"0",str:"2",int:"0",agi:"0",dex:"0",vit:"0",wis:"0",res_fire:"0",res_wind:"0",res_earth:"0",res_water:"0",res_light:"0",res_shadow:"0",atk_fire:"0",atk_wind:"0",atk_earth:"0",atk_water:"0",atk_light:"0",atk_hadow:"0"}]},1466:function(t,e,n){"use strict";function r(t){return t.toLowerCase().split(" ").join("_")}Object.defineProperty(e,"__esModule",{value:!0}),e.idfy=r},1467:function(t,e,n){"use strict";function r(t){return{id:t.toString(),name:(0,a.randomItem)(o.maleNames),class:(0,a.randomItem)(a.classes),movement:"mountain",elem:"neutral",equips:{ornament:"amulet",chest:"iron_armor",mainHand:"iron_sword",offHand:"iron_shield"},squad:null,lvl:11,hp:100,currentHp:100,exp:99,str:(0,s.random)(10,200),agi:(0,s.random)(10,200),dex:(0,s.random)(10,200),vit:(0,s.random)(10,200),int:(0,s.random)(10,200),wis:(0,s.random)(10,200),style:{head:(0,a.randomItem)([1,2,3]),trunk:(0,a.randomItem)([1,2,3,4])}}}function i(t){throw new Error("Not implemented.")}Object.defineProperty(e,"__esModule",{value:!0}),e.fromJSON=r,e.toJSON=i;var o=n(1468),a=n(556),s=n(168)},1468:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.maleNames=void 0;var r=["Lydan","Syrin","Ptorik","Joz","Varog","Gethrod","Hezra","Feron","Ophni","Colborn","Fintis","Gatlin","Jinto","Hagalbar","Krinn","Lenox","Revvyn","Hodus","Dimian","Paskel","Kontas","Weston","Azamarr","Jather","Tekren","Jareth","Adon","Zaden","Eune","Graff","Tez","Jessop","Gunnar","Pike","Domnhar","Baske","Jerrick","Mavrek","Riordan","Wulfe","Straus","Tyvrik","Henndar","Favroe","Whit","Jaris","Renham","Kagran","Lassrin","Vadim","Arlo","Quintis","Vale","Caelan","Yorjan","Khron","Ishmael","Jakrin","Fangar","Roux","Baxar","Hawke","Gatlen","Barak","Nazim","Kadric","Paquin","Kent","Moki","Rankar","Lothe","Ryven","Clawsen","Pakker","Embre","Cassian","Verssek","Dagfinn","Ebraheim","Nesso","Eldermar","Rivik","Rourke","Barton","Hemm","Sarkin","Blaiz","Talon","Agro","Zagaroth","Turrek","Esdel","Lustros","Zenner","Baashar","Dagrod","Gentar","Feston","Khastan","Prishnak"];e.maleNames=r},1469:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(t){return function(e){var n=e.x,r=e.y,i=t.add.image(n,r,"props/grass");i.setScale(.4),i.setOrigin(.5,1),i.setRotation(-.2),t.tweens.add({targets:i,rotation:.2,scaleX:.5,duration:1e3*Math.random()+5e3,repeat:-1,yoyo:!0,ease:"Bounce"})}};e.default=r},1470:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n(558),i=function(t){return function(e,n,i){[{x:e,y:n,scale:i},{x:e-30*i,y:n,scale:.8*i},{x:e+30*i,y:n+20,scale:.7*i},{x:e-60*i,y:n+20,scale:.4*i}].forEach(function(e){var n=t.add.image(e.x,e.y,"props/branch"),i=.3*e.scale,o=(0,r.random)(2,4)/10*-1;n.setScale(i),n.setOrigin(.3,1),n.setRotation(o),t.tweens.add({targets:n,rotation:-1*o,duration:6e3,yoyo:!0,repeat:-1,scaleX:i+i/10,ease:"Bounce"})})}};e.default=i},1471:function(t,e,n){"use strict";function r(t){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t){return t&&t.__esModule?t:{default:t}}function o(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return o=function(){return t},t}function a(t){if(t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var e=o();if(e&&e.has(t))return e.get(t);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var s=i?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=t[a]}return n.default=t,e&&e.set(t,n),n}Object.defineProperty(e,"__esModule",{value:!0}),e.EditSquadScene=void 0;var s=a(n(31)),u=n(46),c=n(39),d=i(n(1472)),l=a(n(1480)),f=i(n(124)),p=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),h=function(t){function e(){var e=t.call(this,"EditSquadScene")||this;return e.unitListScene=null,e.boardScene=null,e.preload=u.preload,console.log("EditSquadScene constructor. this:",e),e}return p(e,t),e.prototype.create=function(t){var e=t.squad;this.add.image(0,0,"backgrounds/squad_edit"),this.renderBoard(e),this.renderUnitList(),this.renderReturnBtn()},e.prototype.renderBoard=function(t){this.boardScene=new l.default(t),this.scene.add(l.BOARD_SCENE_KEY,this.boardScene,!0)},e.prototype.renderUnitList=function(){var t=this;this.unitListScene=new d.default(50,40),this.unitListScene.onDrag=function(e,n,r){return t.onDragFromList(e,n,r)},this.unitListScene.onDragEnd=function(e,n,r,i){return t.onDragEndFromList(e,n,r,i)},this.scene.add("UnitListScene",this.unitListScene,!0)},e.prototype.onDragEndFromList=function(t,e,n,r){var i,o,a,s,u,d,l=null===(i=this.boardScene)||void 0===i?void 0:i.findTileByXY(e,n);console.log("dropped on ",l);var f=this.boardScene;if(f){if(l){var p=(0,c.addUnitToSquad)(t,f.squad,l.boardX,l.boardY),h=Object.values(f.squad.members).find(function(t){return t.x===l.boardX&&t.y===l.boardY});if(console.log("xxx unit to replace",h),f.squad=p,null===(o=this.unitListScene)||void 0===o||o.removeUnit(t),f.placeUnit({member:p.members[t.id],fromOutside:!0}),h){var y=f.unitList.find(function(t){return t.unit.id===h.id});this.tweens.add({targets:null===y||void 0===y?void 0:y.container,y:((null===(a=null===y||void 0===y?void 0:y.container)||void 0===a?void 0:a.y)||0)-200,alpha:0,ease:"Cubic",duration:400,repeat:0,paused:!1,yoyo:!1})}}else console.log("lets return",t,null===(s=this.unitListScene)||void 0===s?void 0:s.rows),null===(u=this.unitListScene)||void 0===u||u.returnToOriginalPosition(t),null===(d=this.unitListScene)||void 0===d||d.scaleDown(r);f.tiles.forEach(function(t){return t.sprite.clearTint()})}},e.prototype.onDragFromList=function(t,e,n){var r=this.boardScene;if(r){r.tiles.forEach(function(t){return t.sprite.clearTint()});var i=r.findTileByXY(e,n);i&&i.sprite.setTint(3407752)}},e.prototype.renderReturnBtn=function(){var t=this;console.log("rendering return btn"),(0,f.default)(1100,100,"Return to title",this.add.container(0,0),this,function(){t.scene.transition({target:"TitleScene",duration:0,moveBelow:!0}),t.destroyChildren()}),(0,f.default)(1100,200,"Return to List",this.add.container(0,0),this,function(){t.destroyChildren(),t.scene.transition({target:"ListSquadsScene",duration:0,moveBelow:!0})}),console.log("done")},e.prototype.destroyChildren=function(){var t,e;null===(t=this.boardScene)||void 0===t||t.destroy(),null===(e=this.unitListScene)||void 0===e||e.destroy()},e}(s.Scene);e.EditSquadScene=h},1472:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(t){return t&&t.__esModule?t:{default:t}}(n(31)),i=n(1473),o=n(39),a=n(99),s=n(74),u=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),c=function(t){function e(e,n){var r=t.call(this,"UnitListScene")||this;return r.x=e,r.y=n,r.controls=[],r.onUnitClick=null,r.onDrag=null,r.onDragEnd=null,r.rows=[],r.page=0,r.itemsPerPage=6,r}return u(e,t),e.prototype.create=function(){this.render(),this.renderControls()},e.prototype.makeBackground=function(){var t=new r.default.Geom.Rectangle(-50,-30,200,90),e=this.add.graphics({fillStyle:{color:255}});return e.alpha=.2,e.fillRectShape(t),e},e.prototype.destroy=function(){var t=this;this.rows.forEach(function(e){return t.scene.remove(t.makeUnitKey(e.chara.unit))}),this.scene.remove()},e.prototype.renderControls=function(){var t=this;this.controls.forEach(function(t){return t.destroy()});var e=(0,i.getUnitsWithoutSquad)((0,o.getUnits)()),n=Object.keys(e).length,r=this.add.image(this.x+100,this.y+630,"arrow_right");n<this.itemsPerPage||this.itemsPerPage*(this.page+1)>=n?r.setAlpha(.5):(r.setInteractive(),r.on("pointerdown",function(e){t.nextPage()}));var a=this.add.image(this.x,this.y+630,"arrow_right");a.setScale(-1,1),0===this.page?a.setAlpha(.5):(a.setInteractive(),a.on("pointerdown",function(e){t.prevPage()})),this.controls=[r,a]},e.prototype.nextPage=function(){this.page=this.page+1,this.clearUnitList(),this.render(),this.renderControls()},e.prototype.prevPage=function(){this.page=this.page-1,this.clearUnitList(),this.render(),this.renderControls()},e.prototype.clearUnitList=function(){var t=this;this.rows.forEach(function(e){t.scene.remove(e.chara.key),t.children.remove(e.container)}),this.rows=[]},e.prototype.getUnitsToRender=function(){var t=(0,i.getUnitsWithoutSquad)((0,o.getUnits)());return Object.values(t).slice(this.page*this.itemsPerPage,this.page*this.itemsPerPage+this.itemsPerPage)},e.prototype.render=function(){var t=this,e=this.getUnitsToRender();console.log("....",e),e.forEach(function(e,n){t.renderUnitListItem(e,n)})},e.prototype.handleUnitClick=function(t){this.onUnitClick&&(console.log("An event to handle unit click has been defined",t),this.onUnitClick(t))},e.prototype.handleUnitDrag=function(t,e,n,r){if(this.scaleUp(r),this.scene.bringToTop(r.key),this.onDrag)return this.onDrag(t,e,n)},e.prototype.handleUnitDragEnd=function(t,e,n,r){this.renderControls(),this.onDragEnd&&this.onDragEnd(t,e,n,r)},e.prototype.renderUnitListItem=function(t,e){var n=this.getRowPosition(e),i=n.charaX,o=n.charaY,s=this.makeUnitKey(t),u=this.add.container(i,o),c=this.onUnitClick?this.handleUnitClick.bind(this):void 0,d=this.onDrag?this.handleUnitDrag.bind(this):void 0,l=this.onDragEnd?this.handleUnitDragEnd.bind(this):void 0,f=new r.default.Geom.Rectangle(-50,-30,200,90),p=this.makeBackground();p.setInteractive(f,r.default.Geom.Rectangle.Contains),u.add(p),c&&p.on("pointerdown",function(){c(t)});var h=new a.Chara(s,this,t,i,o,.5,!0);d&&l&&h.enableDrag(d.bind(this),l.bind(this));var y=this.add.text(40,30,t.name);return u.add(y),this.rows.push({chara:h,text:y,container:u}),h},e.prototype.getRowPosition=function(t){return{charaX:this.x,charaY:this.y+100*t}},e.prototype.getUnitIndex=function(t){return this.rows.findIndex(function(e){return e.chara.unit.id===t.id})},e.prototype.returnToOriginalPosition=function(t){var e=this,n=this.getUnitIndex(t),r=this.rows.find(function(n){return n.chara.key===e.makeUnitKey(t)});if(!r)return(0,s.error)(s.INVALID_STATE);this.reposition(r,n)},e.prototype.scaleUp=function(t){this.tweens.add({targets:t.container,scale:1,duration:400,ease:"Cubic",repeat:0,paused:!1,yoyo:!1})},e.prototype.scaleDown=function(t){this.tweens.add({targets:t.container,scale:.5,duration:400,ease:"Cubic",repeat:0,paused:!1,yoyo:!1})},e.prototype.makeUnitKey=function(t){return"unit-list-"+t.id},e.prototype.reposition=function(t,e){var n=t.chara,r=t.container,i=this.getRowPosition(e),o=i.charaX,a=i.charaY;this.tweens.add({targets:n.container,x:o,y:a,duration:600,ease:"Cubic",repeat:0,paused:!1,yoyo:!1}),this.tweens.add({targets:r,x:o,y:a,duration:600,ease:"Cubic",repeat:0,paused:!1,yoyo:!1})},e.prototype.removeUnit=function(t){var e=this,n=function(e){return e.chara.unit.id===t.id};this.rows.filter(n).forEach(function(t){e.scene.remove(t.chara),e.children.remove(t.container)}),this.rows=this.rows.filter(function(t){return!n(t)}),this.rows.forEach(function(t,n){return e.reposition(t,n)});var r=this.getUnitsToRender();if(!(r.length<1)){var i=r[r.length-1];if(!this.rows.some(function(t){return t.chara.unit.id===i.id})){var o=this.renderUnitListItem(i,this.itemsPerPage-1);o.container&&o.container.setPosition(o.container.x,o.container.y+300);var a=this.rows[this.rows.length-1];a&&this.reposition(a,this.itemsPerPage-1)}}},e}(r.default.Scene),d=c;e.default=d},1473:function(t,e,n){"use strict";function r(t){var e=t.unit,n=t.stat,r=t.items,i=t.slot,o=e.equips[i],a=r[o];if(!a)throw new Error("Invalid State: Item should be in index");var s=a.modifiers[n];return s||0}function i(t,e,n){return n[t]+c.map(function(i){return r({unit:n,stat:t,items:e,slot:i})}).reduce(a.sum,0)}function o(t){return Object.values(t).reduce(function(t,e){var n;return e.squad?t:s(s({},t),(n={},n[e.id]=e,n))},{})}Object.defineProperty(e,"__esModule",{value:!0}),e.getActualStat=i,e.getUnitsWithoutSquad=o,e.makeAnimatedUnit=void 0;var a=n(558),s=function(){return s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},s.apply(this,arguments)},u=function(t,e){return s(s({},e),{container:t.add.container(0,0),tweens:[]})};e.makeAnimatedUnit=u;var c=["mainHand","offHand","chest","ornament"]},1474:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n(169),i=n(168),o=function(t){return t&&t.__esModule?t:{default:t}}(n(559)),a=function(t){t.clearAnimations(),t.add.tween({targets:t.leftFoot,x:r.LEFT_FOOT_FRONT_X-20,yoyo:!0,rotation:-.2,repeat:-1,duration:500}),t.add.tween({targets:t.rightFoot,x:r.RIGHT_FOOT_FRONT_X+10,yoyo:!0,rotation:-.2,repeat:-1,duration:500}),t.add.tween({targets:t.leftHand,x:r.LEFT_HAND_FRONT_X+10,yoyo:!0,rotation:-.2,repeat:-1,duration:500}),t.add.tween({targets:t.mainHandContainer,x:r.RIGHT_HAND_FRONT_X-10,yoyo:!0,rotation:-.2,repeat:-1,duration:500}),t.add.tween({targets:t.charaWrapper,y:r.CHARA_WRAPPER_Y-20,yoyo:!0,repeat:-1,duration:100})},s=function(t){var e,n,r,a;t.clearAnimations(),(0,o.default)(t)(t.charaWrapper,-12,100),t.add.tween({targets:t.leftFoot,x:(0,i.maybeZero)(null===(e=t.leftFoot)||void 0===e?void 0:e.x)-20,yoyo:!0,rotation:-.2,repeat:-1,duration:500}),t.add.tween({targets:t.rightFoot,x:(0,i.maybeZero)(null===(n=t.rightFoot)||void 0===n?void 0:n.x)+10,yoyo:!0,rotation:-.2,repeat:-1,duration:500}),t.add.tween({targets:t.leftHand,x:(0,i.maybeZero)(null===(r=t.leftHand)||void 0===r?void 0:r.x)+10,yoyo:!0,rotation:-.2,repeat:-1,duration:500}),t.add.tween({targets:t.mainHandContainer,x:(0,i.maybeZero)(null===(a=t.mainHandContainer)||void 0===a?void 0:a.x)-10,yoyo:!0,rotation:-.2,repeat:-1,duration:500})},u=function(t){t.front?a(t):s(t)};e.default=u},1475:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n(74),i=n(169),o=function(t){if(t.tweens.killAll(),!(t.head&&t.trunk&&t.leftHand&&t.mainHandContainer&&t.leftFoot&&t.rightFoot&&t.charaWrapper))throw new Error(r.INVALID_STATE);t.head.rotation=0,t.leftFoot.rotation=0,t.leftHand.rotation=0,t.rightFoot.rotation=0,t.mainHandContainer.rotation=0,t.trunk.rotation=0,t.front?(t.charaWrapper.x=i.CHARA_WRAPPER_X,t.charaWrapper.y=i.CHARA_WRAPPER_Y,t.head.x=i.HEAD_FRONT_X,t.head.y=i.HEAD_FRONT_Y,t.leftFoot.x=i.LEFT_FOOT_FRONT_X,t.leftFoot.y=i.LEFT_FOOT_FRONT_Y,t.rightFoot.x=i.RIGHT_FOOT_FRONT_X,t.rightFoot.y=i.RIGHT_FOOT_FRONT_Y,t.leftHand.x=i.LEFT_HAND_FRONT_X,t.leftHand.y=i.LEFT_HAND_FRONT_Y,t.mainHandContainer.x=i.RIGHT_HAND_FRONT_X,t.mainHandContainer.y=i.RIGHT_HAND_FRONT_Y):(t.charaWrapper.x=i.CHARA_WRAPPER_X,t.charaWrapper.y=i.CHARA_WRAPPER_Y,t.head.x=i.HEAD_BACK_X,t.head.y=i.HEAD_BACK_Y,t.leftFoot.x=i.LEFT_FOOT_BACK_X,t.leftFoot.y=i.LEFT_FOOT_BACK_Y,t.rightFoot.x=i.RIGHT_FOOT_BACK_X,t.rightFoot.y=i.RIGHT_FOOT_BACK_Y,t.leftHand.x=i.LEFT_HAND_BACK_X,t.leftHand.y=i.LEFT_HAND_BACK_Y,t.mainHandContainer.x=i.RIGHT_HAND_BACK_X,t.mainHandContainer.y=i.RIGHT_HAND_BACK_Y)};e.default=o},1476:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n(169),i=function(t){return t&&t.__esModule?t:{default:t}}(n(559)),o=function(t){t.clearAnimations(),t.tweens.add({targets:t.head,y:r.HEAD_FRONT_Y-2,duration:1600,yoyo:!0,repeat:-1}),t.tweens.add({targets:t.trunk,y:r.TRUNK_FRONT_Y+2,duration:1600,yoyo:!0,repeat:-1}),t.tweens.add({targets:t.leftHand,y:r.LEFT_HAND_FRONT_Y+8,duration:1600,yoyo:!0,repeat:-1}),t.tweens.add({targets:t.mainHandContainer,y:r.RIGHT_HAND_FRONT_Y-4,duration:1600,yoyo:!0,repeat:-1})},a=function(t){t.clearAnimations();var e=(0,i.default)(t);e(t.head,-2,1600),e(t.trunk,2,1600),e(t.leftHand,4,1600),e(t.mainHandContainer,-4,1600)},s=function(t){t.front?o(t):a(t)};e.default=s},1477:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(t,e,n){var r;n&&t.die(),t.parent.tweens.add({targets:null===t||void 0===t?void 0:t.container,rotation:.15,yoyo:!0,duration:500});var i=t.parent.add.text(-25,0,e.toString(),{fontSize:48});i.setStroke("#000000",2),null===(r=t.container)||void 0===r||r.add(i),t.parent.tweens.add({targets:i,y:-200,alpha:0,duration:3e3,ease:"Expo",onComplete:function(){i.destroy()}})};e.default=r},1478:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(t,e){var n,r;t.clearAnimations(),t.parent.tweens.add({targets:null===t||void 0===t?void 0:t.mainHandContainer,rotation:t.front?1.9:-1.9,yoyo:!0,x:((null===(n=t.mainHandContainer)||void 0===n?void 0:n.x)||0)+(t.front?30:-60),Y:((null===(r=t.mainHandContainer)||void 0===r?void 0:r.y)||0)-20,duration:250,ease:"Expo",onComplete:function(){e()}})};e.default=r},1479:function(t,e,n){"use strict";function r(t){var e,n=function(e,n){var r,i=t.add.image(e,n,"foot");return null===(r=t.container)||void 0===r||r.add(i),i},r=function(e,n,r){var i,o=t.add.image(e,n,"hand");return o.scaleX=r,null===(i=t.container)||void 0===i||i.add(o),o};t.leftFoot=n(o.LEFT_FOOT_FRONT_X,o.LEFT_FOOT_FRONT_Y),t.rightFoot=n(o.RIGHT_FOOT_FRONT_X,o.RIGHT_FOOT_FRONT_Y),t.leftHand=r(o.LEFT_HAND_FRONT_X,o.LEFT_HAND_FRONT_Y,-1),t.trunk=function(e,n){var r,i=t.add.image(e,n,"trunk"+t.unit.style.trunk.toString());return null===(r=t.container)||void 0===r||r.add(i),i}(o.TRUNK_FRONT_X,o.TRUNK_FRONT_Y),t.head=function(e,n){var r,i=t.add.image(e,n,"head"+t.unit.style.head.toString());return null===(r=t.container)||void 0===r||r.add(i),i}(o.HEAD_FRONT_X,o.HEAD_FRONT_Y),t.mainHandContainer=t.add.container(o.RIGHT_HAND_FRONT_X,o.RIGHT_HAND_FRONT_Y),t.mainHand=t.add.image(10,10,"equips/"+t.unit.equips.mainHand),t.mainHandContainer.add(t.mainHand),t.mainHand.setScale(.2),t.mainHand.setOrigin(1,1),t.rightHand=r(-2,0,1),t.rightHand.rotation=-2.2,null===(e=t.container)||void 0===e||e.add(t.mainHandContainer),t.mainHandContainer.add(t.rightHand)}function i(t){function e(e,n){var r,i=t.add.image(e,n,"foot");return i.scaleX=-1,i.rotation=.6,null===(r=t.container)||void 0===r||r.add(i),i}function n(e,n){var r,i=t.add.image(e,n,"hand");return null===(r=t.container)||void 0===r||r.add(i),i}var r;t.mainHandContainer=t.add.container(o.RIGHT_HAND_BACK_X,o.RIGHT_HAND_BACK_Y),null===(r=t.container)||void 0===r||r.add(t.mainHandContainer),t.mainHand=t.add.image(-10,20,"equips/"+t.unit.equips.mainHand),t.mainHandContainer.add(t.mainHand),t.mainHand.setScale(-.2,.2),t.mainHand.setOrigin(1,1),t.rightHand=n(0,0),t.mainHandContainer.add(t.rightHand),t.rightFoot=e(o.RIGHT_FOOT_BACK_X,o.RIGHT_FOOT_BACK_Y),t.rightFoot.scaleY=-1,t.leftFoot=e(o.LEFT_FOOT_BACK_X,o.LEFT_FOOT_BACK_Y),t.leftFoot.scaleY=-1,t.trunk=function(e,n){var r,i=t.add.image(e,n,"back_trunk"+t.unit.style.trunk.toString());return null===(r=t.container)||void 0===r||r.add(i),i}(o.TRUNK_BACK_X,o.TRUNK_BACK_Y),t.head=function(e,n){var r,i=t.add.image(e,n,"back_head"+t.unit.style.head.toString());return null===(r=t.container)||void 0===r||r.add(i),i}(o.HEAD_BACK_X,o.HEAD_BACK_Y),t.leftHand=n(o.LEFT_HAND_BACK_X,o.LEFT_HAND_BACK_Y)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(169),a=function(t){t.front?r(t):i(t)};e.default=a},1480:function(t,e,n){"use strict";function r(t){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return i=function(){return t},t}function o(t){var e=(0,d.cartesianToIsometric)(t.x,t.y);return{x:e.x,y:e.y-230}}function a(t){return function(e){var n=Math.abs(e.sprite.x-t.x),r=Math.abs(e.sprite.y-t.y);return n/f.tileWidth+r/f.tileHeight<1}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.BOARD_SCENE_KEY=void 0;var s=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var e=i();if(e&&e.has(t))return e.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var s=o?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=t[a]}return n.default=t,e&&e.set(t,n),n}(n(31)),u=n(99),c=n(46),d=n(272),l=n(39),f=n(167),p=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),h="BoardScene";e.BOARD_SCENE_KEY=h;var y=function(t){function e(e){var n=t.call(this,h)||this;return n.squad=e,n.tiles=[],n.unitList=[],n.preload=c.preload,n.onUnitDragEnd=function(t,e,r){var i,a,s,u=n.squad;console.log("the squad",u),console.log(n.tiles,e,r);var c=n.findTileByXY(e,r),d=u.members[t.id];if(!d)throw new Error("Invalid state. Unit should be in board object.");if(c&&function(t){return d.x!==t.boardX||d.y!==t.boardY}(c))n.changeUnitPositionInBoard({unit:t,x:c.boardX,y:c.boardY});else{var l=o(d),f=l.x,p=l.y;console.log("TWEEN: return to original"),n.tweens.add({targets:null===(i=n.getChara(t))||void 0===i?void 0:i.container,x:f,y:p,ease:"Cubic",duration:400,repeat:0,paused:!1,yoyo:!1})}n.tiles.map(function(t){return t.sprite.clearTint()}),(null===(s=null===(a=n.getChara(t))||void 0===a?void 0:a.container)||void 0===s?void 0:s.list).map(function(t){return t.clearTint()})},n.onUnitDrag=function(t,e,r){var i=n.findTileByXY(e,r);n.tiles.map(function(t){return t.sprite.clearTint()}),i&&i.sprite.setTint(52224),n.scene.bringToTop(n.makeUnitKey(t))},console.log("boardScene constructor"),n}return p(e,t),e.prototype.create=function(){this.tiles=this.placeTiles({mapWidth:3,mapHeight:3}),this.placeUnits()},e.prototype.findTileByXY=function(t,e){return this.tiles.find(a({x:t,y:e+100}))},e.prototype.changeUnitPositionInBoard=function(t){var e=this,n=t.unit,r=t.x,i=t.y,o=(0,l.changeSquadMemberPosition)(this.squad.members[n.id],this.squad,r,i);this.squad.members=o.members,console.log("the received updatedBoard",o),o.updatedUnits.forEach(function(t){e.moveUnitToBoardTile(t.id,t.x,t.y)})},e.prototype.moveUnitToBoardTile=function(t,e,n){var r=this,i=this.unitList.find(function(e){return e.unit.id===t});if(i){var a=i.unit,s=o(this.squad.members[a.id]);this.tweens.add({targets:null===i||void 0===i?void 0:i.container,x:s.x,y:s.y,ease:"Cubic",duration:400,repeat:0,paused:!1,yoyo:!1}).on("complete",function(){r.sortUnitsByDepth()})}},e.prototype.getChara=function(t){var e=this;return this.unitList.find(function(n){return n.key===e.makeUnitKey(t)})},e.prototype.placeTiles=function(t){for(var e=this,n=t.mapWidth,r=t.mapHeight,i=[[]],o=[],s=0;s<n;s++){i[s]=[];for(var u=0;u<r;u++)i[s][u]=null}return i.forEach(function(t,n){t.forEach(function(t,r){var i=(0,d.cartesianToIsometric)(r,n),a=i.x,s=i.y,u=e.add.image(a,s,"tile");u.depth=s,u.setInteractive(),o.push({sprite:u,x:a,y:s,boardX:r+1,boardY:n+1})})}),this.input.on("pointerdown",function(t){e.tiles.filter(a(t)).forEach(function(t){console.log("clicked>>",t.x,t.y)})}),o},e.prototype.addUnitToBoard=function(t){var e=o(t),n=e.x,r=e.y,i=(0,l.getUnit)(t.id);if(!i)throw new Error("Invalid member supplied.");var a=this.makeUnitKey(i),s=new u.Chara(a,this,i,n,r,1,!0);return s.enableDrag(this.onUnitDrag.bind(this),this.onUnitDragEnd.bind(this)),s},e.prototype.placeUnits=function(){var t=this,e=this.squad;console.log("...",e.members),Object.values(e.members).forEach(function(e){return t.placeUnit({member:e,fromOutside:!1})})},e.prototype.placeUnit=function(t){var e=t.member,n=t.fromOutside,r=this.addUnitToBoard(e);this.unitList=this.unitList.concat([r]),this.sortUnitsByDepth(),n&&(this.squad.members[e.id]=e)},e.prototype.makeUnitKey=function(t){return"board-"+t.id},e.prototype.sortUnitsByDepth=function(){this.unitList.forEach(function(t){var e,n;return null===(e=t.container)||void 0===e?void 0:e.setDepth(null===(n=t.container)||void 0===n?void 0:n.y)}),this.unitList.sort(function(t,e){var n,r;return((null===(n=t.container)||void 0===n?void 0:n.depth)||0)-((null===(r=e.container)||void 0===r?void 0:r.depth)||0)}).forEach(function(t){return t.scene.bringToTop()})},e.prototype.destroy=function(){var t=this;this.tiles.forEach(function(t){return t.sprite.destroy()}),this.unitList.forEach(function(e){return t.scene.remove(t.makeUnitKey(e.unit))}),this.scene.remove()},e}(s.Scene),v=y;e.default=v},1481:function(t,e,n){"use strict";function r(t){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t){return t&&t.__esModule?t:{default:t}}function o(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return o=function(){return t},t}function a(t){if(t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var e=o();if(e&&e.has(t))return e.get(t);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var s=i?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=t[a]}return n.default=t,e&&e.set(t,n),n}Object.defineProperty(e,"__esModule",{value:!0}),e.ListSquadsScene=void 0;var s=a(n(31)),u=n(46),c=a(n(39)),d=i(n(1482)),l=i(n(124)),f=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),p=function(t){function e(){var e=t.call(this,"ListSquadsScene")||this;return e.boardScenes=[],e.controls=[],e.selectedSquadInfo=null,e.page=0,e.itemsPerPage=9,e.preload=u.preload,e}return f(e,t),e.prototype.create=function(){this.renderSquadList(),this.renderControls()},e.prototype.renderSquadList=function(){var t=this,e=Object.values(c.getSquads()).slice(this.page*this.itemsPerPage,this.page*this.itemsPerPage+this.itemsPerPage);this.formatList(e,[]).forEach(function(e,n){return e.forEach(function(e,r){return t.renderBoard(e,r,n)})})},e.prototype.formatList=function(t,e){if(t.length<=3)return e.concat([t]);var n=t.slice(0,3);return this.formatList(t.slice(3,t.length),e.concat([n]))},e.prototype.renderSelectSquadInfo=function(t){var e,n=this;this.selectedSquadInfo&&this.selectedSquadInfo.destroy(),null===(e=this.selectedSquadInfo)||void 0===e||e.destroy(),this.selectedSquadInfo=this.add.container(0,0),this.selectedSquadInfo.name=t.id;var r=this.add.text(10,680,t.name);this.selectedSquadInfo.add(r),(0,l.default)(1100,350,"Edit",this.selectedSquadInfo,this,function(){n.editSquad(t)}),(0,l.default)(1100,400,"Disband Squad",this.selectedSquadInfo,this,function(){n.selectedSquadInfo&&(c.disbandSquad(n.selectedSquadInfo.name),n.refresh())})},e.prototype.renderBoard=function(t,e,n){var r=this,i=new d.default(t,320*e,170*n,.3);this.scene.add("board-squad-"+t.id,i,!0),i.onClick(function(t){return r.renderSelectSquadInfo(t)}),this.boardScenes.push(i)},e.prototype.renderControls=function(){var t=this;(0,l.default)(1100,10,"Return to Title",this.add.container(0,0),this,function(){t.removeChildren(),t.scene.transition({target:"TitleScene",duration:0,moveBelow:!0})}),(0,l.default)(1100,600,"Create Squad",this.add.container(0,0),this,function(){t.removeChildren();var e=Object.keys(c.getSquads());t.scene.transition({target:"EditSquadScene",duration:0,moveBelow:!0,data:{squad:{id:(e.length+1).toString(),name:"",emblem:"",members:{}}}})}),this.renderNavigation()},e.prototype.renderNavigation=function(){var t=this,e=c.getSquads(),n=Object.keys(e).length,r=this.add.image(400,630,"arrow_right");r.setScale(-1,1),0===this.page?r.setAlpha(.5):(r.setInteractive(),r.on("pointerdown",function(e){t.prevPage()})),this.controls.push(r);var i=this.add.image(500,630,"arrow_right");n<this.itemsPerPage||this.itemsPerPage*(this.page+1)>=n?i.setAlpha(.5):(i.setInteractive(),i.on("pointerdown",function(){t.nextPage()})),this.controls.push(i)},e.prototype.refresh=function(){this.removeChildren(),this.renderSquadList(),this.renderControls()},e.prototype.nextPage=function(){this.page=this.page+1,this.refresh()},e.prototype.prevPage=function(){this.page=this.page-1,this.refresh()},e.prototype.removeChildren=function(){var t=this;this.boardScenes.forEach(function(e){e.destroy(t)}),this.boardScenes=[],this.controls.forEach(function(t){return t.destroy()}),this.controls=[]},e.prototype.editSquad=function(t){this.removeChildren(),this.scene.transition({target:"EditSquadScene",duration:0,moveBelow:!0,data:{squad:t}})},e}(s.Scene);e.ListSquadsScene=p},1482:function(t,e,n){"use strict";function r(t){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return i=function(){return t},t}function o(t){return"static-squad-"+t.id}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var e=i();if(e&&e.has(t))return e.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var s=o?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=t[a]}return n.default=t,e&&e.set(t,n),n}(n(31)),s=n(99),u=n(46),c=n(272),d=n(39),l=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),f=function(t){function e(e,n,r,i){var a=t.call(this,o(e))||this;return a.squad=e,a.x=n,a.y=r,a.scaleSizing=i,a.tiles=[],a.unitList=[],a.overlay=null,a.preload=u.preload,a}return l(e,t),e.prototype.create=function(){this.tiles=this.placeTiles({mapWidth:3,mapHeight:3}),this.placeUnits(),this.makeOverlay()},e.prototype.destroy=function(t){var e=this;console.log("lets remove a board",this),this.tiles.forEach(function(t){return t.sprite.destroy()}),this.unitList.forEach(function(n){var r=e.makeUnitKey(n.unit);t.scene.remove(r)}),console.log("removing board scene",this.scene.key),t.scene.remove(o(this.squad))},e.prototype.makeOverlay=function(){var t=new a.Geom.Rectangle(this.x+60,this.y+40,250,150),e=this.add.graphics({});e.alpha=.2,e.fillRectShape(t),this.overlay=e},e.prototype.onClick=function(t){var e,n,r=this,i=new a.Geom.Rectangle(this.x+60,this.y+40,250,150);null===(e=this.overlay)||void 0===e||e.setInteractive(i,a.Geom.Rectangle.Contains),null===(n=this.overlay)||void 0===n||n.on("pointerdown",function(){t(r.squad)})},e.prototype.placeTiles=function(t){for(var e=this,n=t.mapWidth,r=t.mapHeight,i=[[]],o=[],a=0;a<n;a++){i[a]=[];for(var s=0;s<r;s++)i[a][s]=null}return i.forEach(function(t,n){t.forEach(function(t,r){var i=(0,c.cartesianToIsometric)(r,n),a=i.x,s=i.y;a=a*e.scaleSizing+e.x,s=s*e.scaleSizing+e.y;var u=e.add.image(a,s,"tile");u.scale=e.scaleSizing,u.depth=s,o.push({sprite:u,x:a,y:s,boardX:r+1,boardY:n+1})})}),o},e.prototype.addUnitToBoard=function(t){var e=this.getUnitPositionInScreen(t),n=e.x,r=e.y;n=n*this.scaleSizing+this.x,r=r*this.scaleSizing+this.y;var i=(0,d.getUnit)(t.id);if(!i)throw new Error("Invalid member supplied");var o=this.makeUnitKey(i);return new s.Chara(o,this,i,n,r,this.scaleSizing,!0)},e.prototype.placeUnits=function(){var t=this,e=this.squad;Object.values(e.members).forEach(function(e){return t.placeUnit(e)})},e.prototype.placeUnit=function(t){var e=this.addUnitToBoard(t);this.unitList=this.unitList.concat([e]),this.sortUnitsByDepth()},e.prototype.makeUnitKey=function(t){return"board-unit-"+t.id},e.prototype.sortUnitsByDepth=function(){this.unitList.forEach(function(t){var e,n;return null===(e=t.container)||void 0===e?void 0:e.setDepth(null===(n=t.container)||void 0===n?void 0:n.y)}),this.unitList.sort(function(t,e){var n,r;return((null===(n=t.container)||void 0===n?void 0:n.depth)||0)-((null===(r=e.container)||void 0===r?void 0:r.depth)||0)}).forEach(function(t){return t.scene.bringToTop()})},e.prototype.getUnitPositionInScreen=function(t){var e=(0,c.cartesianToIsometric)(t.x,t.y);return{x:e.x,y:e.y-230}},e}(a.Scene),p=f;e.default=p},1483:function(t,e,n){"use strict";function r(t){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return i=function(){return t},t}function o(t){if(t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var e=i();if(e&&e.has(t))return e.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var s=o?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=t[a]}return n.default=t,e&&e.set(t,n),n}Object.defineProperty(e,"__esModule",{value:!0}),e.ListUnitsScene=void 0;var a=o(n(31)),s=n(46),u=o(n(39)),c=n(99),d=n(1484),l=function(t){return t&&t.__esModule?t:{default:t}}(n(124)),f=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),p=function(t){function e(){var e=t.call(this,"ListUnitsScene")||this;return e.units=[],e.page=0,e.itemsPerPage=40,e.unitDetails=[],e.detailsBar=null,e.preload=s.preload,e}return f(e,t),e.prototype.create=function(){var t=this;this.detailsBar=new d.UnitDetailsBarScene,this.renderUnitsList(),this.scene.add("details-bar",this.detailsBar,!0),(0,l.default)(1120,20,"Back to Title",this.add.container(0,0),this,function(){t.removeChildren(),t.scene.remove("UnitDetailsBarScene"),t.scene.transition({target:"TitleScene",duration:0,moveBelow:!0})})},e.prototype.renderUnitsList=function(){var t=this,e=Object.values(u.getUnits()).slice(this.page*this.itemsPerPage,this.page*this.itemsPerPage+this.itemsPerPage);this.formatList(e,[]).forEach(function(e,n){return e.forEach(function(e,r){return t.renderUnit(e,r,n)})})},e.prototype.formatList=function(t,e){if(t.length<=10)return e.concat([t]);var n=t.slice(0,10);return this.formatList(t.slice(10,t.length),e.concat([n]))},e.prototype.renderUnit=function(t,e,n){var r=this,i="list-chara-"+t.id,o=new c.Chara(i,this,t,100+120*e,100+110*n,.6,!0);o.onClick(function(t){r.renderUnitDetails(t)}),this.units.push(o)},e.prototype.renderUnitDetails=function(t){var e;null===(e=this.detailsBar)||void 0===e||e.render(t.unit.id)},e.prototype.renderNavigation=function(){},e.prototype.refresh=function(){this.removeChildren(),this.renderUnitsList()},e.prototype.nextPage=function(){this.page=this.page+1,this.refresh()},e.prototype.prevPage=function(){this.page=this.page-1,this.refresh()},e.prototype.removeChildren=function(){var t,e=this;this.units.forEach(function(t){e.scene.remove("list-chara-"+t.unit.id)}),this.units=[],null===(t=this.detailsBar)||void 0===t||t.destroy(this)},e}(a.Scene);e.ListUnitsScene=p},1484:function(t,e,n){"use strict";function r(t){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return i=function(){return t},t}function o(t){if(t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var e=i();if(e&&e.has(t))return e.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var s=o?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=t[a]}return n.default=t,e&&e.set(t,n),n}Object.defineProperty(e,"__esModule",{value:!0}),e.UnitDetailsBarScene=void 0;var a=o(n(31)),s=n(46),u=o(n(39)),c=n(74),d=n(1485),l=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),f=function(t){function e(){var e=t.call(this,"UnitDetailsBarScene")||this;return e.colWidth=100,e.rowHeight=30,e.chara=null,e.container=null,e.itemDetail=null,e.preload=s.preload,e.write=function(t,n,r){var i;return null===(i=e.container)||void 0===i?void 0:i.add(e.add.text(t,n,"number"==typeof r?r.toString():r,{color:"#000"}))},e.col=function(t,n,r){return r.forEach(function(r,i){return e.write(t,n+e.rowHeight*i,r)})},e}return l(e,t),e.prototype.create=function(){this.itemDetail=new d.ItemDetailWindowScene,this.scene.add("item-detail",this.itemDetail,!0)},e.prototype.destroy=function(t){var e;null===(e=this.container)||void 0===e||e.destroy(),t.scene.remove("ItemDetailWindowScene"),t.scene.remove("UnitDetailsBarScene")},e.prototype.clearChildren=function(){var t;null===(t=this.container)||void 0===t||t.destroy(),this.container=this.add.container(10,520)},e.prototype.renderBgLayer=function(){},e.prototype.render=function(t){var e;this.clearChildren();var n=this.add.image(0,0,"panel");null===(e=this.container)||void 0===e||e.add(n),n.setOrigin(0,0),n.displayWidth=1260,n.displayHeight=180;var r=u.getUnit(t);if(!r)throw new Error(c.INVALID_STATE);this.unitStats(r),this.unitItems(r)},e.prototype.unitStats=function(t){var e=t.str,n=t.agi,r=t.int,i=t.wis,o=t.vit,a=t.dex;this.write(10,10,t.name),this.col(10+this.colWidth,10,["STR","AGI","INT"]),this.col(10+2*this.colWidth,10,[e,n,r]),this.col(10+3*this.colWidth,10,["WIS","VIT","DEX"]),this.col(10+4*this.colWidth,10,[i,o,a])},e.prototype.unitItems=function(t){var e=this,n=function(n,r,i){var o,a,s,d=u.getItem(t.equips[i]);if(!d)throw new Error(c.INVALID_STATE);var l=e.add.image(n,r,"panel");l.displayWidth=74,l.displayHeight=74,null===(o=e.container)||void 0===o||o.add(l);var f=e.add.image(n,r,d.id);f.displayWidth=64,f.displayHeight=64,f.setInteractive(),f.on("pointerdown",function(){var n;console.log("clicked1!!",i),null===(n=e.itemDetail)||void 0===n||n.render(d.id,t.id,function(){return e.render(t.id)})});var p=e.add.text(n+32+5+10,r,d.name);null===(a=e.container)||void 0===a||a.add(p),null===(s=e.container)||void 0===s||s.add(f)};n(600,50,"mainHand"),n(600,129,"offHand"),n(879,50,"chest"),n(879,129,"ornament")},e}(a.Scene);e.UnitDetailsBarScene=f},1485:function(t,e,n){"use strict";function r(t){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return i=function(){return t},t}function o(t){if(t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var e=i();if(e&&e.has(t))return e.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var s=o?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=t[a]}return n.default=t,e&&e.set(t,n),n}Object.defineProperty(e,"__esModule",{value:!0}),e.ItemDetailWindowScene=void 0;var a=o(n(31)),s=n(46),u=o(n(39)),c=n(74),d=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),l=function(t){function e(){var e=t.call(this,"ItemDetailWindowScene")||this;return e.x=100,e.y=100,e.colWidth=100,e.rowHeight=30,e.container=null,e.selectecItemDetailsContainer=null,e.preload=s.preload,e.write=function(t,n,r,i){var o,a=e.add.text(t,n,"number"==typeof r?r.toString():r,{color:"#000"});i?i.add(a):null===(o=e.container)||void 0===o||o.add(a)},e.col=function(t,n,r){return r.forEach(function(r,i){return e.write(t,n+e.rowHeight*i,r,null)})},e}return d(e,t),e.prototype.create=function(){},e.prototype.clearChildren=function(){var t;null===(t=this.container)||void 0===t||t.destroy()},e.prototype.render=function(t,e,n){var r=this;this.clearChildren(),this.container=this.add.container(this.x,this.y),this.renderBgLayer(this.container),this.renderPanel(0,0,300,300,this.container);var i=u.getItem(t);if(!i)throw new Error(c.INVALID_STATE);this.itemIcon(100,50,i,60,this.container),this.write(100,10,i.name,this.container),this.itemStats(i,10,120,this.container),this.btn(150,250,"Replace",function(){return r.replaceItemList(i,e,n)})},e.prototype.renderBgLayer=function(t){var e=this,n=new a.Geom.Rectangle(-1*this.x,-1*this.y,1280,520),r=this.add.graphics({fillStyle:{color:0}});r.alpha=.3,r.fillRectShape(n),t.add(r),r.setInteractive(n,a.Geom.Rectangle.Contains),r.on("pointerdown",function(){e.clearChildren(),r.destroy()})},e.prototype.renderPanel=function(t,e,n,r,i){var o,s=new a.Geom.Rectangle(t,e,n,r),u=this.add.graphics({fillStyle:{color:14592647},lineStyle:{width:2,color:0}});u.strokeRectShape(s),u.fillRectShape(s),u.strokeRect(t,e,n,r),i?i.add(u):null===(o=this.container)||void 0===o||o.add(u)},e.prototype.replaceItemList=function(t,e,n){var r=this,i=u.getItemList().filter(function(e){return e.slot===t.slot&&e.id!==t.id});this.renderPanel(350,0,300,400,this.container),i.forEach(function(t,i){if(!r.container)throw new Error(c.INVALID_STATE);var o=100*i+10,s=r.makeBackground(350,0);s.x=360,s.y=o;var u=new a.Geom.Rectangle(0,0,300,80);s.setInteractive(u,a.Geom.Rectangle.Contains),s.on("pointerdown",function(){r.selectedItemDetails(t,e,350,0,n)}),r.container.add(s),r.itemIcon(360,o,t,50,r.container),r.write(450,50+o,t.name,r.container)})},e.prototype.itemIcon=function(t,e,n,r,i){this.renderPanel(t,e,r+20,r+20,i);var o=this.add.image(t+r/2+10,e+r/2+10,n.id);o.displayWidth=r,o.displayHeight=r,null===i||void 0===i||i.add(o)},e.prototype.selectedItemDetails=function(t,e,n,r,i){var o,a,s=this;null===(o=this.selectecItemDetailsContainer)||void 0===o||o.destroy(),this.selectecItemDetailsContainer=this.add.container(0,0),null===(a=this.container)||void 0===a||a.add(this.selectecItemDetailsContainer),this.renderPanel(n+350,r,300,300,this.selectecItemDetailsContainer),this.write(n+370,r+20,t.name,this.selectecItemDetailsContainer),this.itemIcon(n+450,r+50,t,60,this.selectecItemDetailsContainer),this.itemStats(t,n+370,r+130,this.selectecItemDetailsContainer),this.btn(n+400,r+250,"Equip",function(){u.equipItem(t.id,e),s.clearChildren(),i()})},e.prototype.makeBackground=function(t,e){var n=new a.Geom.Rectangle(-10,e+-10,300,80),r=this.add.graphics({fillStyle:{color:255}});return r.alpha=.2,r.fillRectShape(n),r},e.prototype.btn=function(t,e,n,r){var i,o,a=this.add.text(t,e,n,{color:"#000"}),s=this.add.image(t-15,e-10,"panel");s.setOrigin(0,0),null===(i=this.container)||void 0===i||i.add(s),null===(o=this.container)||void 0===o||o.add(a),s.setInteractive(),s.displayWidth=a.width+30,s.displayHeight=a.height+20,s.on("pointerdown",function(){r()})},e.prototype.itemStats=function(t,e,n,r){var i=this;Object.keys(t.modifiers).filter(function(e){var n=t.modifiers[e];return n&&0!==n}).forEach(function(o,a){var s=t.modifiers[o];i.write(e,n+i.rowHeight*a,o,r),i.write(e+200,n+i.rowHeight*a,s.toString(),r)})},e}(a.Scene);e.ItemDetailWindowScene=l},1486:function(t,e,n){"use strict";function r(t){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t){return t&&t.__esModule?t:{default:t}}function o(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return o=function(){return t},t}function a(t){if(t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var e=o();if(e&&e.has(t))return e.get(t);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var s=i?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=t[a]}return n.default=t,e&&e.set(t,n),n}Object.defineProperty(e,"__esModule",{value:!0}),e.MapScene=void 0;var s=a(n(31)),u=n(99),c=n(46),d=n(39),l=n(74),f=i(n(124)),p=a(n(1487)),h=i(n(1492)),y=i(n(1493)),v=n(1494),_=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),m=function(){return m=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},m.apply(this,arguments)},g="0",b=500,T=new p.js,O=[10],w={cells:[[10,11,10,10,10,10,10,10,27,22,22,22,22],[10,11,10,10,10,10,10,10,10,10,10,10,11],[10,11,10,10,10,10,10,24,20,25,10,10,11],[10,10,10,10,10,10,10,23,11,21,10,10,11],[10,11,10,10,10,10,10,27,22,26,10,10,11],[11,11,11,11,11,10,10,10,10,10,10,11,11]],forces:[{id:g,name:"Player",squads:[{id:"0",x:0,y:0,moves:5,remainingMoves:5}]},{id:"1",name:"CPU",squads:[{id:"2",x:3,y:2,moves:5,remainingMoves:5},{id:"3",x:3,y:1,moves:5,remainingMoves:5},{id:"4",x:4,y:2,moves:5,remainingMoves:5},{id:"5",x:4,y:1,moves:5,remainingMoves:5},{id:"6",x:3,y:0,moves:5,remainingMoves:5}]}],cities:[{id:"a1",name:"Arabella",x:1,y:1,force:g},{id:"m1",name:"Marqueze",x:3,y:1,force:"1"}]},S=function(t){function e(){var e=t.call(this,"MapScene")||this;return e.squads=[],e.tiles=[],e.selectedSquad=null,e.currentForce=g,e.preload=c.preload,e.moveUnit=function(t,n){var r=function(){n.forEach(function(t){return e.getTileAt(t.x,t.y).tile.clearTint()})},i=n.filter(function(t,e){return e>0}).map(function(i,o){var a=e.getCharaPosition(i);return{targets:t.container,x:a.x,y:a.y,duration:b,ease:"Cubic",onComplete:o===n.length-2?r():null}});e.tweens.timeline({tweens:i})},e.findPath=function(t,n){var r=w.cells.map(function(t){return t.map(v.identity)});return e.getEnemies().forEach(function(t){r[t.y][t.x]=1}),T.setGrid(r),T.setAcceptableTiles(O),new Promise(function(e){T.findPath(t.x,t.y,n.x,n.y,function(t){e(t)}),T.calculate()})},e}return _(e,t),e.prototype.getForce=function(t){var e=w.forces.find(function(e){return e.id===t});if(!e)throw new Error(l.INVALID_STATE);return e},e.prototype.getForceSquad=function(t,e){var n=t.squads.find(function(t){return t.id===e});if(!n)throw new Error(l.INVALID_STATE);return n},e.prototype.getPos=function(t,e){return{x:50+100*t,y:50+100*e}},e.prototype.renderMap=function(t,e){var n=this;console.log("MapScene - renderMap"),w.cells.forEach(function(e,r){return e.forEach(function(e,i){var o=n.getPos(i,r),a=o.x,s=o.y,u=function(){return 10===e?n.add.image(a,s,"tiles/grass"):11===e?n.add.image(a,s,"tiles/woods"):20===e?n.add.image(a,s,"tiles/mountain1"):21===e?n.add.image(a,s,"tiles/mountain2"):22===e?n.add.image(a,s,"tiles/mountain3"):23===e?n.add.image(a,s,"tiles/mountain4"):24===e?n.add.image(a,s,"tiles/mountain5"):25===e?n.add.image(a,s,"tiles/mountain6"):26===e?n.add.image(a,s,"tiles/mountain7"):27===e?n.add.image(a,s,"tiles/mountain8"):n.add.image(a,s,"tiles/grass")}();u.setInteractive(),t.add(u),u.displayWidth=100,u.displayHeight=100,n.tiles.push({x:i,y:r,type:e,tile:u,distance:0})})})},e.prototype.makeInteractive=function(t,e){var n=this;e.tile.on("pointerdown",function(){n.selectedSquad&&n.selectTile(t,n.selectedSquad,e)})},e.prototype.clearAllTileEvents=function(){this.tiles.forEach(function(t){return t.tile.removeAllListeners()})},e.prototype.renderUnits=function(t,e){var n=this;console.log("MapScene - renderUnits"),w.forces.forEach(function(r){r.squads.forEach(function(i){return n.renderSquad(r,t,e,i)})})},e.prototype.getCharaPosition=function(t){var e=t.x,n=t.y,r=this.getPos(e,n);return m(m({},r),{y:r.y+-10})},e.prototype.renderSquad=function(t,e,n,r){var i=this,o=(0,d.getSquadLeader)(r.id);if(o){var a=this.getCharaPosition(r),s=a.x,c=a.y,f=new u.Chara("chara"+o.id,this,o,s,c,.5,!0);f.container&&e.add(f.container),this.squads.push(f),f.onClick(function(e){if(!e.unit.squad)throw new Error(l.INVALID_STATE);var r=i.getForceSquad(i.getForce(i.currentForce),e.unit.squad);if(t.id===g){if(i.selectedSquad=e.unit.squad,r.remainingMoves<1)return void console.info("No move points remaining for",r);var o=r.remainingMoves;i.tilesInRange(r.x,r.y,o+2).filter(function(t){return O.includes(t.type)}).filter(function(t){return!i.isEnemyInTile(t)}).filter(function(t){return t.x!==r.x||t.y!==r.y}).forEach(function(t){i.findPath(r,t).then(function(e){e&&e.length<=o+1&&(t.tile.setTint(10092441),t.distance=e.length-1,i.makeInteractive(n,t))})}),i.refreshUI(n)}else w.forces.filter(function(t){return t.id===g}).forEach(function(t){return t.squads.filter(function(t){return t.id===i.selectedSquad}).forEach(function(t){1===i.getDistance(t,r)&&(console.log("attack!!",r),i.scene.transition({target:"CombatScene",duration:0,moveBelow:!0,data:{top:f.unit.squad,bottom:i.selectedSquad}}))})})})}},e.prototype.refreshUI=function(t){t.destroy(),this.renderUI(this.add.container(0,0))},e.prototype.renderUI=function(t){var e=this;if(console.log("MapScene - renderUI"),t.add((0,h.default)(0,600,1280,120,t,this)),this.selectedSquad){var n=this.getForce(this.currentForce),r=(0,d.getSquad)(this.selectedSquad),i=this.getForceSquad(n,this.selectedSquad);(0,y.default)(20,610,r.name,t,this),(0,y.default)(1e3,610,i.remainingMoves+" moves",t,this)}(0,f.default)(1100,50,"Return to Title",this.add.container(0,0),this,function(){e.squads.forEach(function(t){return e.scene.remove("chara"+t.unit.id)}),t.destroy(),e.squads=[],e.tiles=[],e.scene.transition({target:"TitleScene",duration:0,moveBelow:!0})})},e.prototype.create=function(){console.log("MapScene - create");var t=this.add.container(0,0),e=this.add.container(0,0);this.renderMap(t,e),this.renderUnits(t,e),this.renderUI(e),this.runTurn()},e.prototype.runTurn=function(){var t=this.getForce(this.currentForce),e=this.add.text(-200,500,t.name+" Turn"),n=this.tweens.createTimeline();n.add({targets:e,x:700,ease:"Bounce",duration:500}),n.add({targets:e,x:800,duration:1500}),n.add({targets:e,x:1700,duration:500}),n.play(),this.refreshMoves(t)},e.prototype.refreshMoves=function(t){var e=t.squads.map(function(t){return m(m({},t),{remainingMoves:t.moves})});w.forces=w.forces.map(function(n){return n.id===t.id?m(m({},n),{squads:e}):n})},e.prototype.tilesInRange=function(t,e,n){var r=this;return this.tiles.filter(function(i){return r.getDistance({x:t,y:e},i)<=n})},e.prototype.getDistance=function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},e.prototype.selectTile=function(t,e,n){var r=this,i=n.x,o=n.y,a=n.distance;console.log("MapScene - selectTile");var s=this.squads.find(function(t){return t.unit.id===e}),u=w.forces.find(function(t){return t.id===g});if(!s||!u)throw new Error(l.INVALID_STATE);var c=u.squads.find(function(t){return t.id===s.unit.squad});if(!c)throw new Error(l.INVALID_STATE);this.tiles.forEach(function(t){return O.includes(t.type)?t.tile.clearTint():null}),this.findPath(c,{x:i,y:o}).then(function(t){return r.moveUnit(s,t)}),c.x=i,c.y=o,c.remainingMoves=c.remainingMoves-a,this.refreshUI(t),this.clearAllTileEvents()},e.prototype.isEnemyInTile=function(t){return this.getEnemies().some(function(e){return e.x===t.x&&e.y===t.y})},e.prototype.getEnemies=function(){return w.forces.filter(function(t){return t.id!==g}).map(function(t){return t.squads}).flat()},e.prototype.getTileAt=function(t,e){var n=this.tiles.find(function(n){return n.x===t&&n.y===e});if(!n)throw new Error(l.INVALID_STATE);return n},e}(s.Scene);e.MapScene=S},1487:function(t,e,n){var r={},i=n(1488),o=n(1489),a=n(1490);t.exports=r;var s=1;r.js=function(){var t,e,n,u=!1,c={},d={},l={},f={},p=!0,h={},y=[],v=Number.MAX_VALUE,_=!1;this.setAcceptableTiles=function(t){t instanceof Array?n=t:!isNaN(parseFloat(t))&&isFinite(t)&&(n=[t])},this.enableSync=function(){u=!0},this.disableSync=function(){u=!1},this.enableDiagonals=function(){_=!0},this.disableDiagonals=function(){_=!1},this.setGrid=function(e){t=e;for(var n=0;n<t.length;n++)for(var r=0;r<t[0].length;r++)d[t[n][r]]||(d[t[n][r]]=1)},this.setTileCost=function(t,e){d[t]=e},this.setAdditionalPointCost=function(t,e,n){void 0===l[e]&&(l[e]={}),l[e][t]=n},this.removeAdditionalPointCost=function(t,e){void 0!==l[e]&&delete l[e][t]},this.removeAllAdditionalPointCosts=function(){l={}},this.setDirectionalCondition=function(t,e,n){void 0===f[e]&&(f[e]={}),f[e][t]=n},this.removeAllDirectionalConditions=function(){f={}},this.setIterationsPerCalculation=function(t){v=t},this.avoidAdditionalPoint=function(t,e){void 0===c[e]&&(c[e]={}),c[e][t]=1},this.stopAvoidingAdditionalPoint=function(t,e){void 0!==c[e]&&delete c[e][t]},this.enableCornerCutting=function(){p=!0},this.disableCornerCutting=function(){p=!1},this.stopAvoidingAllAdditionalPoints=function(){c={}},this.findPath=function(e,r,o,c,d){var l=function(t){u?d(t):setTimeout(function(){d(t)})};if(void 0===n)throw new Error("You can't set a path without first calling setAcceptableTiles() on EasyStar.");if(void 0===t)throw new Error("You can't set a path without first calling setGrid() on EasyStar.");if(e<0||r<0||o<0||c<0||e>t[0].length-1||r>t.length-1||o>t[0].length-1||c>t.length-1)throw new Error("Your start or end point is outside the scope of your grid.");if(e===o&&r===c)return void l([]);for(var f=t[c][o],p=!1,v=0;v<n.length;v++)if(f===n[v]){p=!0;break}if(!1===p)return void l(null);var _=new i;_.openList=new a(function(t,e){return t.bestGuessDistance()-e.bestGuessDistance()}),_.isDoneCalculating=!1,_.nodeHash={},_.startX=e,_.startY=r,_.endX=o,_.endY=c,_.callback=l,_.openList.push(O(_,_.startX,_.startY,null,1));var m=s++;return h[m]=_,y.push(m),m},this.cancelPath=function(t){return t in h&&(delete h[t],!0)},this.calculate=function(){if(0!==y.length&&void 0!==t&&void 0!==n)for(e=0;e<v;e++){if(0===y.length)return;u&&(e=0);var r=y[0],i=h[r];if(void 0!==i)if(0!==i.openList.size()){var o=i.openList.pop();if(i.endX!==o.x||i.endY!==o.y)o.list=0,o.y>0&&m(i,o,0,-1,1*T(o.x,o.y-1)),o.x<t[0].length-1&&m(i,o,1,0,1*T(o.x+1,o.y)),o.y<t.length-1&&m(i,o,0,1,1*T(o.x,o.y+1)),o.x>0&&m(i,o,-1,0,1*T(o.x-1,o.y)),_&&(o.x>0&&o.y>0&&(p||g(t,n,o.x,o.y-1,o)&&g(t,n,o.x-1,o.y,o))&&m(i,o,-1,-1,1.4*T(o.x-1,o.y-1)),o.x<t[0].length-1&&o.y<t.length-1&&(p||g(t,n,o.x,o.y+1,o)&&g(t,n,o.x+1,o.y,o))&&m(i,o,1,1,1.4*T(o.x+1,o.y+1)),o.x<t[0].length-1&&o.y>0&&(p||g(t,n,o.x,o.y-1,o)&&g(t,n,o.x+1,o.y,o))&&m(i,o,1,-1,1.4*T(o.x+1,o.y-1)),o.x>0&&o.y<t.length-1&&(p||g(t,n,o.x,o.y+1,o)&&g(t,n,o.x-1,o.y,o))&&m(i,o,-1,1,1.4*T(o.x-1,o.y+1)));else{var a=[];a.push({x:o.x,y:o.y});for(var s=o.parent;null!=s;)a.push({x:s.x,y:s.y}),s=s.parent;a.reverse();var c=a;i.callback(c),delete h[r],y.shift()}}else i.callback(null),delete h[r],y.shift();else y.shift()}};var m=function(e,r,i,o,a){var s=r.x+i,u=r.y+o;if((void 0===c[u]||void 0===c[u][s])&&g(t,n,s,u,r)){var d=O(e,s,u,r,a);void 0===d.list?(d.list=1,e.openList.push(d)):r.costSoFar+a<d.costSoFar&&(d.costSoFar=r.costSoFar+a,d.parent=r,e.openList.updateItem(d))}},g=function(t,e,n,r,i){var o=f[r]&&f[r][n];if(o){var a=b(i.x-n,i.y-r);if(!function(){for(var t=0;t<o.length;t++)if(o[t]===a)return!0;return!1}())return!1}for(var s=0;s<e.length;s++)if(t[r][n]===e[s])return!0;return!1},b=function(t,e){if(0===t&&-1===e)return r.TOP;if(1===t&&-1===e)return r.TOP_RIGHT;if(1===t&&0===e)return r.RIGHT;if(1===t&&1===e)return r.BOTTOM_RIGHT;if(0===t&&1===e)return r.BOTTOM;if(-1===t&&1===e)return r.BOTTOM_LEFT;if(-1===t&&0===e)return r.LEFT;if(-1===t&&-1===e)return r.TOP_LEFT;throw new Error("These differences are not valid: "+t+", "+e)},T=function(e,n){return l[n]&&l[n][e]||d[t[n][e]]},O=function(t,e,n,r,i){if(void 0!==t.nodeHash[n]){if(void 0!==t.nodeHash[n][e])return t.nodeHash[n][e]}else t.nodeHash[n]={};var a=w(e,n,t.endX,t.endY);if(null!==r)var s=r.costSoFar+i;else s=0;var u=new o(r,e,n,s,a);return t.nodeHash[n][e]=u,u},w=function(t,e,n,r){if(_){var i=Math.abs(t-n),o=Math.abs(e-r);return i<o?1.4*i+o:1.4*o+i}var i=Math.abs(t-n),o=Math.abs(e-r);return i+o}},r.TOP="TOP",r.TOP_RIGHT="TOP_RIGHT",r.RIGHT="RIGHT",r.BOTTOM_RIGHT="BOTTOM_RIGHT",r.BOTTOM="BOTTOM",r.BOTTOM_LEFT="BOTTOM_LEFT",r.LEFT="LEFT",r.TOP_LEFT="TOP_LEFT"},1488:function(t,e){t.exports=function(){this.pointsToAvoid={},this.startX,this.callback,this.startY,this.endX,this.endY,this.nodeHash={},this.openList}},1489:function(t,e){t.exports=function(t,e,n,r,i){this.parent=t,this.x=e,this.y=n,this.costSoFar=r,this.simpleDistanceToTarget=i,this.bestGuessDistance=function(){return this.costSoFar+this.simpleDistanceToTarget}}},1490:function(t,e,n){t.exports=n(1491)},1491:function(t,e,n){var r,i,o;(function(){var n,a,s,u,c,d,l,f,p,h,y,v,_,m,g;s=Math.floor,h=Math.min,a=function(t,e){return t<e?-1:t>e?1:0},p=function(t,e,n,r,i){var o;if(null==n&&(n=0),null==i&&(i=a),n<0)throw new Error("lo must be non-negative");for(null==r&&(r=t.length);n<r;)o=s((n+r)/2),i(e,t[o])<0?r=o:n=o+1;return[].splice.apply(t,[n,n-n].concat(e)),e},d=function(t,e,n){return null==n&&(n=a),t.push(e),m(t,0,t.length-1,n)},c=function(t,e){var n,r;return null==e&&(e=a),n=t.pop(),t.length?(r=t[0],t[0]=n,g(t,0,e)):r=n,r},f=function(t,e,n){var r;return null==n&&(n=a),r=t[0],t[0]=e,g(t,0,n),r},l=function(t,e,n){var r;return null==n&&(n=a),t.length&&n(t[0],e)<0&&(r=[t[0],e],e=r[0],t[0]=r[1],g(t,0,n)),e},u=function(t,e){var n,r,i,o,u,c;for(null==e&&(e=a),o=function(){c=[];for(var e=0,n=s(t.length/2);0<=n?e<n:e>n;0<=n?e++:e--)c.push(e);return c}.apply(this).reverse(),u=[],r=0,i=o.length;r<i;r++)n=o[r],u.push(g(t,n,e));return u},_=function(t,e,n){var r;if(null==n&&(n=a),-1!==(r=t.indexOf(e)))return m(t,0,r,n),g(t,r,n)},y=function(t,e,n){var r,i,o,s,c;if(null==n&&(n=a),i=t.slice(0,e),!i.length)return i;for(u(i,n),c=t.slice(e),o=0,s=c.length;o<s;o++)r=c[o],l(i,r,n);return i.sort(n).reverse()},v=function(t,e,n){var r,i,o,s,d,l,f,y,v;if(null==n&&(n=a),10*e<=t.length){if(o=t.slice(0,e).sort(n),!o.length)return o;for(i=o[o.length-1],f=t.slice(e),s=0,l=f.length;s<l;s++)r=f[s],n(r,i)<0&&(p(o,r,0,null,n),o.pop(),i=o[o.length-1]);return o}for(u(t,n),v=[],d=0,y=h(e,t.length);0<=y?d<y:d>y;0<=y?++d:--d)v.push(c(t,n));return v},m=function(t,e,n,r){var i,o,s;for(null==r&&(r=a),i=t[n];n>e&&(s=n-1>>1,o=t[s],r(i,o)<0);)t[n]=o,n=s;return t[n]=i},g=function(t,e,n){var r,i,o,s,u;for(null==n&&(n=a),i=t.length,u=e,o=t[e],r=2*e+1;r<i;)s=r+1,s<i&&!(n(t[r],t[s])<0)&&(r=s),t[e]=t[r],e=r,r=2*e+1;return t[e]=o,m(t,u,e,n)},n=function(){function t(t){this.cmp=null!=t?t:a,this.nodes=[]}return t.push=d,t.pop=c,t.replace=f,t.pushpop=l,t.heapify=u,t.updateItem=_,t.nlargest=y,t.nsmallest=v,t.prototype.push=function(t){return d(this.nodes,t,this.cmp)},t.prototype.pop=function(){return c(this.nodes,this.cmp)},t.prototype.peek=function(){return this.nodes[0]},t.prototype.contains=function(t){return-1!==this.nodes.indexOf(t)},t.prototype.replace=function(t){return f(this.nodes,t,this.cmp)},t.prototype.pushpop=function(t){return l(this.nodes,t,this.cmp)},t.prototype.heapify=function(){return u(this.nodes,this.cmp)},t.prototype.updateItem=function(t){return _(this.nodes,t,this.cmp)},t.prototype.clear=function(){return this.nodes=[]},t.prototype.empty=function(){return 0===this.nodes.length},t.prototype.size=function(){return this.nodes.length},t.prototype.clone=function(){var e;return e=new t,e.nodes=this.nodes.slice(0),e},t.prototype.toArray=function(){return this.nodes.slice(0)},t.prototype.insert=t.prototype.push,t.prototype.top=t.prototype.peek,t.prototype.front=t.prototype.peek,t.prototype.has=t.prototype.contains,t.prototype.copy=t.prototype.clone,t}(),function(n,a){i=[],r=a,void 0!==(o="function"==typeof r?r.apply(e,i):r)&&(t.exports=o)}(0,function(){return n})}).call(this)},1492:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(t,e,n,r,i,o){var a=new Phaser.Geom.Rectangle(t,e,n,r),s=o.add.graphics({fillStyle:{color:14592647},lineStyle:{width:2,color:0}});return s.strokeRectShape(a),s.fillRectShape(a),s.strokeRect(t,e,n,r),i.add(s),s};e.default=r},1493:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(t,e,n,r,i){var o=i.add.text(t,e,"number"==typeof n?n.toString():n,{color:"#000"});r.add(o)};e.default=r},1494:function(t,e,n){"use strict";function r(t){return t}Object.defineProperty(e,"__esModule",{value:!0}),e.identity=r},1495:function(t,e,n){"use strict";function r(t){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return i=function(){return t},t}function o(t){if(t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var e=i();if(e&&e.has(t))return e.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var s=o?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=t[a]}return n.default=t,e&&e.set(t,n),n}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(n(31)),s=n(46),u=n(99),c=o(n(39)),d=n(272),l=n(74),f=n(1496),p=function(t){return t&&t.__esModule?t:{default:t}}(n(557)),h=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),y=function(t){return 1===t?3:3===t?1:t},v=function(t){return function(e){if(!e.squad)throw new Error(l.INVALID_STATE);var n=c.getSquad(e.squad);if(!n)throw new Error(l.INVALID_STATE);var r=n.members[e.id],i=r.x,o=r.y;return{x:n.id===t?i:y(i),y:n.id===t?o:y(o)}}},_=function(t){function e(){var e=t.call(this,"CombatScene")||this;return e.units=[],e.top="",e.bottom="",e.currentTurn=0,e.preload=s.preload,e}return h(e,t),e.prototype.updateUnit=function(t){this.units=this.units.map(function(e){return e.unit.id===t.id&&(e.unit=t),e})},e.prototype.create=function(t){var e=this;(0,p.default)(this),this.top=t.top,this.bottom=t.bottom,[t.top,t.bottom].forEach(function(n){var r=c.getSquadMembers(n),i=n===t.top,o=v(t.top);r.sort(function(t,e){return o(t).y-o(e).y}).forEach(function(t){var n=o(t),r=(0,d.cartesianToIsometricBattle)(i,n.x,n.y),a=r.x,s=r.y,c=new u.Chara("combat-chara-"+t.id,e,t,a,s,1,i);e.units.push(c)})}),setTimeout(function(){e.turn()},1e3)},e.prototype.destroy=function(){this.removeChildren(),this.scene.remove(this)},e.prototype.removeChildren=function(){var t=this;this.units.forEach(function(e){var n;null===(n=e.container)||void 0===n||n.destroy(),t.scene.remove(e)})},e.prototype.turn=function(){var t=(0,f.runCombat)(this.units.map(function(t){return t.unit}));console.log(">>>",t),this.execute(t)},e.prototype.execute=function(t){var e=this,n=t[0];console.log("Command:",n);var r=function(t){return t.filter(function(t,e){return e>0})},i=function(){var n=r(t);0===n.length?console.log("finish!"):e.execute(n)};"MOVE"===n.type?this.moveUnit(n.source,n.target).then(i):"ATTACK"===n.type?this.attack(n.source,n.target,n.damage,n.updatedTarget).then(i):"RETURN"===n.type?this.return(n.target).then(i):"END_TURN"===n.type?(this.currentTurn=this.currentTurn+1,this.turn()):"RESTART_TURNS"===n.type?(this.currentTurn=0,this.turn()):"VICTORY"===n.type?console.log("Winning Team:",n.target):console.error("Unknown command:",n)},e.prototype.getChara=function(t){var e=this.units.find(function(e){return e.unit.id===t});if(!e||!e.container)throw new Error(l.INVALID_STATE);return e},e.prototype.moveUnit=function(t,e){var n=this,r=this.getChara(t),i=this.getChara(e);r.clearAnimations(),r.run();var o=this.top===i.unit.squad;if(!i.container)throw new Error(l.INVALID_STATE);var a=c.getSquadMember(i.unit.id),s=(0,d.cartesianToIsometricBattle)(o,o?a.x+1:y(a.x)-1,o?a.y:y(a.y)),u=s.x,f=s.y,p=function(t){return{targets:r.container,x:u,y:f,duration:500,onComplete:function(){t()}}},h={delay:500/60,callback:function(){n.units.sort(function(t,e){return t.container&&e.container?t.container.y-e.container.y:0}).forEach(function(t){return n.scene.bringToTop(t.key)})},repeat:60};return new Promise(function(t){n.time.addEvent(h),n.tweens.add(p(t))})},e.prototype.attack=function(t,e,n,r){this.updateUnit(r);var i=this.getChara(t),o=this.getChara(e);return new Promise(function(t){i.attack(t),o.flinch(n,0===r.currentHp)})},e.prototype.return=function(t){var e=this,n=this.getChara(t);n.clearAnimations(),n.run();var r=v(this.top)(n.unit),i=(0,d.cartesianToIsometricBattle)(this.top===n.unit.squad,r.x,r.y),o=i.x,a=i.y,s=function(t){return{targets:n.container,x:o,y:a,duration:500,onComplete:function(){console.log("stand!!"),n.stand(),t()}}};return new Promise(function(t){e.tweens.add(s(t))})},e}(a.Scene),m=_;e.default=m},1496:function(t,e,n){"use strict";function r(t,e){return e.filter(a(t)).every(function(t){return!o(t)})}function i(t,e){return e.filter(a(t)).filter(o).sort(function(t,e){return t.currentHp-e.currentHp})[0]}function o(t){return t.currentHp>0}function a(t){return function(e){return t.squad!==e.squad}}Object.defineProperty(e,"__esModule",{value:!0}),e.getTarget=i,e.runTurn=e.runCombat=e.initiativeList=void 0;var s=n(74),u=function(){return u=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},u.apply(this,arguments)},c=function(t){return t.agi+t.dex},d=function(t){return t.sort(function(t,e){return c(e)-c(t)})};e.initiativeList=d;var l=function(t){var e=d(t);return f(0,e,[])};e.runCombat=l;var f=function t(e,n,o){var a=n[e],c=n.length-1===e,d=c?0:e+1;if(a.currentHp<1)return t(d,n,o);if(!a.squad)throw new Error(s.INVALID_STATE);var l=i(a,n);if(!l)throw new Error(s.INVALID_STATE);var f=n.map(function(t){var e=t.currentHp-22,n=e<1?0:e;return t.id===l.id?u(u({},t),{currentHp:n}):t}),p=f.find(function(t){return t.id===l.id});if(!p)throw new Error(s.INVALID_STATE);var h=[{type:"MOVE",source:a.id,target:l.id}],y=[{type:"ATTACK",source:a.id,target:l.id,damage:22,updatedTarget:p}],v=[{type:"RETURN",target:a.id}],_=o.concat(h).concat(y).concat(v),m={type:"VICTORY",target:a.squad};return r(a,f)?_.concat([m]):t(d,f,_)};e.runTurn=f},167:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tileHeight=e.tileWidth=e.centerY=e.centerX=e.SCREEN_HEIGHT=e.SCREEN_WIDTH=void 0;e.SCREEN_WIDTH=1280;e.SCREEN_HEIGHT=720;e.centerX=640;e.centerY=260;e.tileWidth=128;e.tileHeight=64},168:function(t,e,n){"use strict";function r(t,e){return Math.floor(Math.random()*e+t)}function i(t,e){return Object.values(e).reduce(function(e,n){var r;return n.id===t?e:o(o({},e),(r={},r[n.id]=n,r))},{})}Object.defineProperty(e,"__esModule",{value:!0}),e.random=r,e.removeIdFromMap=i,e.maybeZero=e.sceneLinkButton=e.indexById=void 0;var o=function(){return o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},o.apply(this,arguments)},a=function(t){return t.reduce(function(t,e){var n;return o(o({},t),(n={},n[e.id]=e,n))},{})};e.indexById=a;var s=function(t,e,n,r,i,o){var a=t.add.text(n,r,e);return a.setInteractive(),a.on("pointerdown",function(){i(),t.scene.transition({target:o,duration:0,moveBelow:!0})}),a};e.sceneLinkButton=s;var u=function(t){return t||0};e.maybeZero=u},169:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TRUNK_BACK_Y=e.TRUNK_BACK_X=e.RIGHT_FOOT_BACK_Y=e.RIGHT_FOOT_BACK_X=e.LEFT_FOOT_BACK_Y=e.LEFT_FOOT_BACK_X=e.LEFT_HAND_BACK_Y=e.LEFT_HAND_BACK_X=e.RIGHT_HAND_BACK_Y=e.RIGHT_HAND_BACK_X=e.HEAD_BACK_Y=e.HEAD_BACK_X=e.RIGHT_HAND_FRONT_Y=e.RIGHT_HAND_FRONT_X=e.LEFT_HAND_FRONT_Y=e.LEFT_HAND_FRONT_X=e.TRUNK_FRONT_Y=e.TRUNK_FRONT_X=e.RIGHT_FOOT_FRONT_Y=e.RIGHT_FOOT_FRONT_X=e.LEFT_FOOT_FRONT_Y=e.LEFT_FOOT_FRONT_X=e.HEAD_FRONT_Y=e.HEAD_FRONT_X=e.CHARA_WRAPPER_Y=e.CHARA_WRAPPER_X=void 0;e.CHARA_WRAPPER_X=0;e.CHARA_WRAPPER_Y=0;e.HEAD_FRONT_X=0;e.HEAD_FRONT_Y=0;e.LEFT_FOOT_FRONT_X=20;e.LEFT_FOOT_FRONT_Y=90;e.RIGHT_FOOT_FRONT_X=-10;e.RIGHT_FOOT_FRONT_Y=97;e.TRUNK_FRONT_X=0;e.TRUNK_FRONT_Y=55;e.LEFT_HAND_FRONT_X=35;e.LEFT_HAND_FRONT_Y=55;e.RIGHT_HAND_FRONT_X=-30;e.RIGHT_HAND_FRONT_Y=60;e.HEAD_BACK_X=0;e.HEAD_BACK_Y=0;e.RIGHT_HAND_BACK_X=20;e.RIGHT_HAND_BACK_Y=50;e.LEFT_HAND_BACK_X=-30;e.LEFT_HAND_BACK_Y=50;e.LEFT_FOOT_BACK_X=20;e.LEFT_FOOT_BACK_Y=80;e.RIGHT_FOOT_BACK_X=-10;e.RIGHT_FOOT_BACK_Y=87;e.TRUNK_BACK_X=0;e.TRUNK_BACK_Y=55},272:function(t,e,n){"use strict";function r(t,e){return{x:(t-e)*o.tileWidth+o.centerX,y:(t+e)*o.tileHeight+o.centerY}}function i(t,e,n){var r=(e-n)*o.tileWidth,i=(e+n)*o.tileHeight/2;return{x:r+(t?350:900),y:i+(t?50:350)}}Object.defineProperty(e,"__esModule",{value:!0}),e.cartesianToIsometric=r,e.cartesianToIsometricBattle=i;var o=n(167)},39:function(t,e,n){"use strict";function r(t,e,n,r){var i,o,a={leader:n.leader,x:t,y:e,id:n.id},s=Object.values(r).find(function(n){return n.x===t&&n.y===e});if(s){var c=u(u({},s),{x:n.x,y:n.y});return{members:u(u({},r),(i={},i[n.id]=a,i[s.id]=c,i)),updatedUnits:[{id:n.id,x:t,y:e},{id:s.id,x:n.x,y:n.y}]}}return{members:u(u({},r),(o={},o[n.id]=a,o)),updatedUnits:[{id:n.id,x:t,y:e}]}}Object.defineProperty(e,"__esModule",{value:!0}),e.equipItem=e.createSquad=e.removeUnitFromSquad=e.changeSquadMemberPosition=e.addUnitToSquad=e.unitsWithoutSquad=e.disbandSquad=e.saveSquadUnit=e.saveUnit=e.saveSquad=e.saveItems=e.saveUnits=e.saveSquads=e.getUnit=e.getItemTypes=e.getItemList=e.getItem=e.getItems=e.getUnits=e.getSquadLeader=e.getSquadMember=e.getSquadMembers=e.getSquad=e.getSquads=void 0;var i=n(1464),o=n(555),a=n(168),s=n(74),u=function(){return u=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},u.apply(this,arguments)},c=function(t){return JSON.parse(localStorage.getItem(t)||"{}")},d=function(t,e){return localStorage.setItem(t,JSON.stringify(e))},l=function(){return c("squads")};e.getSquads=l;var f=function(t){var e=Object.values(l()).find(function(e){return e.id===t});if(!e)throw new Error(s.INVALID_STATE);return e};e.getSquad=f;var p=function(t){var e=f(t);return Object.values(e.members).map(function(t){return T(t.id)}).filter(function(t){return t})};e.getSquadMembers=p;var h=function(t){var e=T(t);if(!e||!e.squad)throw new Error(s.INVALID_STATE);var n=f(e.squad);return Object.values(n.members).find(function(e){return e.id===t})};e.getSquadMember=h;var y=function(t){var e=p(t),n=e.find(function(e){return e.id===t});if(!n)throw new Error(s.INVALID_STATE);return n};e.getSquadLeader=y;var v=function(){return c("units")};e.getUnits=v;var _=function(){return c("items")};e.getItems=_;var m=function(t){var e=_()[t];if(!e)throw new Error(s.INVALID_STATE);return e};e.getItem=m;var g=function(){return Object.values(_())};e.getItemList=g;var b=function(){return o.itemTypeSlots};e.getItemTypes=b;var T=function(t){var e=v()[t];if(!e)throw new Error(s.INVALID_STATE);return e};e.getUnit=T;var O=function(t){return d("squads",t)};e.saveSquads=O;var w=function(t){return d("units",t)};e.saveUnits=w;var S=function(t){return d("items",t)};e.saveItems=S;var E=function(t){var e,n=l();O(u(u({},n),(e={},e[t.id]=t,e)))};e.saveSquad=E;var A=function(t){var e,n=v();w(u(u({},n),(e={},e[t.id]=t,e)))};e.saveUnit=A;var I=function(t){var e,n,r,i=t.squadId,o=t.unitId,a=t.x,s=t.y;console.log("save squad unit",i,o,a,s);var c=l(),d=c[i];O(u(u({},c),(e={},e[i]=u(u({},d),{members:u(u({},d.members),(n={},n[o]={id:o,x:a,y:s,leader:!0===(null===(r=d.members[o])||void 0===r?void 0:r.leader)},n))}),e)))};e.saveSquadUnit=I;var P=function(t){var e=l(),n=e[t];Object.values(n.members).forEach(function(t){return R(t.id,n)});var r=(0,a.removeIdFromMap)(t,e);O(r)};e.disbandSquad=P;var x=function(){return(0,i.unitsWithoutSquadSelector)(v())};e.unitsWithoutSquad=x;var k=function(t,e,n,r){var i,o=e.members,a={leader:0===Object.keys(o).length,x:n,y:r,id:t.id};console.log("NEW ENTRY",a);var c=Object.values(o).find(function(t){return t.x===n&&t.y===r});if(c){console.log("REMOVE EXISTING");var d=Object.values(o).filter(function(t){return t.id!==c.id}),l=d.concat([a]).reduce(function(t,e){var n;return u(u({},t),(n={},n[e.id]=e,n))},{}),f=u(u({},e),{members:l}),p=T(c.id);if(!p)throw new Error(s.INVALID_STATE);return A(u(u({},p),{squad:null})),A(u(u({},t),{squad:e.id})),E(f),f}var l=u(u({},o),(i={},i[t.id]=a,i)),f=u(u({},e),{members:l,name:a.leader?t.name:e.name});return A(u(u({},t),{squad:e.id})),E(f),f};e.addUnitToSquad=k;var H=function(t,e,n,i){console.log("change position",t,e,n,i);var o=e.members,a=r(n,i,t,o);console.log("ujpdated board",a);var s=u(u({},e),{members:a.members});return console.log("will save updatedSquad",s),E(s),console.log("will return",a),a};e.changeSquadMemberPosition=H;var R=function(t,e){var n=T(t);if(!n)throw new Error("ERROR: tried to save unit with invalid ID");var r=u(u({},n),{squad:null}),i=e.members,o=(0,a.removeIdFromMap)(t,i),s=u(u({},e),{members:o});A(r),E(s)};e.removeUnitFromSquad=R;var C=function(t){var e,n,r=l(),i=r.length.toString(),o={id:i,name:t.name,emblem:"Emoji",members:(e={},e[t.id]={id:t.id,leader:!0,x:2,y:2},e)},a=u(u({},r),(n={},n[i]=o,n)),s=u(u({},t),{squad:i}),c=function(t){O(a),A(s);var e=v();console.log(e,a),t({units:e,squads:a})};return new Promise(c)};e.createSquad=C;var D=function(t,e){var n,r=T(e),i=m(t);if(!r)throw new Error("An invalid unit id was supplied to equipItem");if(!i)throw new Error("An invalid item id was supplied to equipItem");var o=b()[i.type],a=u(u({},r),{equips:u(u({},r.equips),(n={},n[o]=i.id,n))});A(a)};e.equipItem=D},46:function(t,e,n){"use strict";function r(){var t=this;["insignea","tile","hand","foot","backgrounds/plain","backgrounds/squad_edit"].forEach(function(e){return t.load.image(e,i+"/"+e+".svg")});var e=[1,2,3,4];e.forEach(function(e){t.load.image("head"+e.toString(),i+"/head.svg"),t.load.image("back_head"+e.toString(),i+"/back_head.svg")}),e.forEach(function(e){t.load.image("trunk"+e.toString(),i+"/trunk.svg"),t.load.image("back_trunk"+e.toString(),i+"/back_trunk.svg")}),["arrow_right","panel"].forEach(function(e){t.load.image(e,i+"/ui/"+e+".svg")}),["amulet","iron_armor","iron_shield","iron_sword","steel_armor","steel_shield","steel_sword","baldar_armor","baldar_shield","baldar_sword"].forEach(function(e){t.load.image(e,i+"/items/"+e+".png")}),["equips/iron_sword","equips/steel_sword","equips/baldar_sword"].forEach(function(e){t.load.image(e,i+"/"+e+".svg")}),["props/grass","props/bush","props/far_tree_1","props/branch"].forEach(function(e){t.load.image(e,i+"/"+e+".svg")}),["tiles/grass","tiles/woods","tiles/mountain1","tiles/mountain2","tiles/mountain3","tiles/mountain4","tiles/mountain5","tiles/mountain6","tiles/mountain7","tiles/mountain8"].forEach(function(e){t.load.image(e,i+"/"+e+".svg")})}Object.defineProperty(e,"__esModule",{value:!0}),e.preload=r;var i="assets"},555:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.itemTypeSlots=e.modifiers=void 0;var r={str:0,agi:0,dex:0,vit:0,int:0,wis:0,atk:0,def:0,m_atk:0,m_def:0,res_fire:0,res_water:0,res_earth:0,res_wind:0,res_light:0,res_shadow:0};e.modifiers=r;var i={accessory:"ornament",sword:"mainHand",axe:"mainHand",robe:"chest",light_armor:"chest",shield:"offHand"};e.itemTypeSlots=i},556:function(t,e,n){"use strict";function r(t,e){var n=e.type,r=e.name,o=Object.keys(i.modifiers),s=function(t,e){var n,r=e[0],i=e[1];return o.includes(r)?c(c({},t),(n={},n[r]=parseInt(i),n)):t},u=Object.entries(e).filter(function(t){return!["name","type","description"].includes(t[0])}),d=u.reduce(s,i.modifiers),l=i.itemTypeSlots[n];return i.itemTypeSlots[n]?t.concat([{id:(0,a.idfy)(e.name),name:r,type:n,slot:l,description:e.description,modifiers:d}]):t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.clearDB=e.player=e.items=e.squads=e.units=e.randomItem=e.classes=void 0;var i=n(555),o=function(t){return t&&t.__esModule?t:{default:t}}(n(1465)),a=n(1466),s=n(1467),u=n(168),c=function(){return c=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},c.apply(this,arguments)},d=["fighter","apprentice"];e.classes=d;var l=function(t){return t[Math.floor(Math.random()*t.length)]};e.randomItem=l;var f=(0,u.indexById)(Array.from({length:70},function(t,e){return e}).map(function(t){return(0,s.fromJSON)(t)}));e.units=f;var p={};e.squads=p;for(var h=0;h<15;h++)p[h.toString()]=function(t,e){var n;return e.squad=t.toString(),{id:t.toString(),name:e.name,emblem:"Emoji",members:(n={},n[e.id]={id:e.id,leader:!0,x:2,y:2},n)}}(h,f[h]);var y=(0,u.indexById)(o.default.reduce(r,[]));e.items=y;var v={id:"player_1",name:"Player Derp",gold:100,iventory:{iron_sword:2,steel_sword:1}};e.player=v;var _=[["units",f],["squads",p],["items",y],["itemTypes",i.itemTypeSlots],["player",v]],m=function(){_.forEach(function(t){var e=t[0],n=t[1];localStorage.setItem(e,JSON.stringify(n))}),alert("db cleared!")};e.clearDB=m;var g=function(){_.forEach(function(t){var e=t[0],n=t[1];localStorage.getItem(e),localStorage.setItem(e,JSON.stringify(n))})};e.default=g},557:function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=r(n(1469)),o=r(n(1470)),a=n(167),s=function(t){var e=t.add.image(0,0,"backgrounds/plain");e.setOrigin(0,0),e.displayWidth=a.SCREEN_WIDTH,e.displayHeight=a.SCREEN_HEIGHT,[{x:350,y:40},{x:320,y:60},{x:460,y:70},{x:420,y:80},{x:550,y:110},{x:590,y:120},{x:680,y:120},{x:1110,y:350},{x:1130,y:370}].forEach((0,i.default)(t)),[{x:320,y:700},{x:390,y:710},{x:450,y:750},{x:1250,y:450},{x:50,y:410}].forEach(function(e){var n=e.x,r=e.y,i=t.add.image(n,r,"props/bush");i.setScale(1),i.setOrigin(.5,1),t.tweens.add({targets:i,scaleX:1.25,duration:2e3*Math.random()+1e4,repeat:-1,yoyo:!0,ease:"Linear"})});var n=t.add.image(870,130,"props/far_tree_1");n.setScale(.5),n.setOrigin(.5,1),t.tweens.add({targets:n,scaleX:.55,rotation:-.2,duration:1200*Math.random()+4e3,repeat:-1,yoyo:!0,ease:"Linear"}),(0,o.default)(t)(1e3,250,.4)};e.default=s},558:function(t,e,n){"use strict";function r(t,e){return t+e}Object.defineProperty(e,"__esModule",{value:!0}),e.sum=r,e.random=void 0;var i=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)};e.random=i},559:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(t){return function(e,n,r){return t.tweens.add({targets:e,y:e?e.y+n:0,yoyo:!0,duration:r,repeat:-1})}};e.default=r},560:function(t,e,n){t.exports=n(561)},561:function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}n(31);var i=n(167),o=r(n(1463)),a=n(1471),s=n(1481),u=n(1483),c=n(1486),d=r(n(1495)),l={type:Phaser.AUTO,backgroundColor:"#125555",width:i.SCREEN_WIDTH,height:i.SCREEN_HEIGHT,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},scene:[o.default,a.EditSquadScene,s.ListSquadsScene,u.ListUnitsScene,c.MapScene,d.default]};new Phaser.Game(l).scale.lockOrientation(Phaser.Scale.PORTRAIT)},74:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.error=e.INVALID_STATE=e.NOT_IMPLEMENTED=void 0;e.NOT_IMPLEMENTED="NOT_IMPLEMENTED";e.INVALID_STATE="INVALID_STATE";var r=function(t){throw new Error(t)};e.error=r},99:function(t,e,n){"use strict";function r(t){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t){return t&&t.__esModule?t:{default:t}}function o(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return o=function(){return t},t}Object.defineProperty(e,"__esModule",{value:!0}),e.Chara=void 0;var a=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var e=o();if(e&&e.has(t))return e.get(t);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var s=i?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=t[a]}return n.default=t,e&&e.set(t,n),n}(n(31)),s=i(n(1474)),u=i(n(1475)),c=i(n(1476)),d=i(n(1477)),l=i(n(1478)),f=i(n(1479)),p=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),h=function(t){function e(e,n,r,i,o,a,s){var u=t.call(this,e)||this;return u.key=e,u.parent=n,u.unit=r,u.cx=i,u.cy=o,u.scaleSizing=a,u.front=s,u.container=null,u.charaWrapper=null,u.head=null,u.trunk=null,u.leftHand=null,u.rightHand=null,u.leftFoot=null,u.rightFoot=null,u.mainHandContainer=null,u.mainHand=null,n.scene.add(e,u,!0),u}return p(e,t),e.prototype.create=function(){this.charaWrapper=this.add.container(0,0),this.container=this.add.container(this.cx,this.cy),this.charaWrapper.add(this.container),this.container.setDepth(this.cy),(0,f.default)(this),this.stand(),this.maybeRenderInsignea();this.container.setSize(100,170),this.container.scale=this.scaleSizing,this.container.name=this.unit.id;var t=this.add.text(0,100,this.unit.name,{color:"#000"});this.container.add(t)},e.prototype.maybeRenderInsignea=function(){if(this.unit.leader&&this.container){var t=this.add.image(50,0,"insignea");this.container.add(t)}},e.prototype.onClick=function(t){var e=this;this.container&&(this.container.setInteractive(),this.container.on("pointerdown",function(n){t(e)}))},e.prototype.enableDrag=function(t,e){var n=this;this.container&&(this.container.setInteractive(),this.input.setDraggable(this.container),this.input.on("drag",function(e,r,i,o){n.container&&n.container.setDepth(1/0),r.x=i,r.y=o,t(n.unit,i,o,n)}),this.container.on("dragend",function(t,r,i){var o,a;n.container&&n.container.setDepth(i),e(n.unit,(null===(o=n.container)||void 0===o?void 0:o.x)||0,(null===(a=n.container)||void 0===a?void 0:a.y)||0,n)}))},e.prototype.handleClick=function(t){var e,n=this;null===(e=this.container)||void 0===e||e.on("pointerdown",function(e){t(n,e)})},e.prototype.clearAnimations=function(){(0,u.default)(this)},e.prototype.stand=function(){(0,c.default)(this)},e.prototype.attack=function(t){(0,l.default)(this,t)},e.prototype.flinch=function(t,e){(0,d.default)(this,t,e)},e.prototype.die=function(){console.log("die!!"),this.tweens.add({targets:this.container,alpha:0,duration:1e3})},e.prototype.run=function(){(0,s.default)(this)},e}(a.Scene);e.Chara=h}},[560]);